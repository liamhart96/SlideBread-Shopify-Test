var L=Object.defineProperty;var T=(o,n,s)=>n in o?L(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s;var f=(o,n,s)=>T(o,typeof n!="symbol"?n+"":n,s);import"./modulepreload-polyfill.B5Qt9EMX.min.js";import{r as a,j as t,t as O,c as F}from"./bundle-mjs.DY7OEoBL.min.js";const M=a.createContext({products:[],loading:!1,hasMore:!1,loadNextPage:async()=>{},currentPage:1}),k=()=>a.useContext(M);function P({children:o,productsPerPage:n=12,initialProducts:s=[]}){const[g,m]=a.useState(s),[l,r]=a.useState(!1),[e,i]=a.useState(!0),[c,h]=a.useState(1),[v,b]=a.useState(""),x=a.useCallback((p,d)=>{const u=new URL(window.location.pathname,window.location.origin),y=new URLSearchParams(d);return y.set("page",p.toString()),y.set("view","ajax"),n&&y.set("per_page",n.toString()),u.search=y.toString(),u.toString()},[n]),w=a.useCallback(async p=>{r(!0);try{const d=await fetch(p);if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const u=await d.json();return{products:u.products||[],nextUrl:u.next_url||null,currentPage:u.current_page||null}}catch(d){return console.error("Error fetching products:",d),i(!1),{products:[],nextUrl:null,currentPage:null}}finally{setTimeout(()=>r(!1),300)}},[]),N=a.useCallback(async p=>{s.length===0&&r(!0);const d=x(1,p),u=await w(d);i(!!u.nextUrl),h(u.currentPage||1),s.length===0&&r(!1)},[x,w,s]),E=a.useCallback(async()=>{if(l||!e)return;const p=x(c+1,v),d=await w(p);m(u=>{const y=new Set(u.map(j=>j.id)),S=d.products.filter(j=>!y.has(j.id));return[...u,...S]}),h(d.currentPage||c+1),i(!!d.nextUrl)},[l,e,c,v,x,w]);return a.useEffect(()=>{const p=()=>{const u=window.location.search;u!==v&&(b(u),N(u))};window.addEventListener("popstate",p);const d=window.location.search;return b(d),N(d),()=>{window.removeEventListener("popstate",p)}},[N]),t.jsx(M.Provider,{value:{products:g,loading:l,hasMore:e,loadNextPage:E,currentPage:c},children:o})}function A({title:o,price:n,imageUrl:s,imageAlt:g,url:m,isServerRendered:l}){const r=a.useRef(null);return a.useEffect(()=>{if(!l&&r.current&&!r.current.hasAttribute("data-loaded")){const e=setTimeout(()=>{var i;(i=r.current)==null||i.setAttribute("data-loaded","true")},10);return()=>clearTimeout(e)}},[l]),t.jsxs("div",{ref:r,className:O("product-card group relative",!l&&"opacity-0 transition-opacity duration-500 ease-in-out data-[loaded=true]:opacity-100"),children:[t.jsx("div",{className:"relative",children:t.jsx("a",{href:m,className:"block",children:t.jsx("div",{className:"mb-4 aspect-square overflow-hidden rounded-md bg-gray-100",children:s?t.jsx("img",{src:s,alt:g||o,className:"h-full w-full object-cover transition-transform duration-500",loading:"lazy",width:600,height:600}):t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:t.jsx("span",{className:"text-primary",children:o})})})})}),t.jsx("div",{className:"mt-2",children:t.jsxs("a",{href:m,className:"block",children:[t.jsx("h3",{className:"text-primary group-hover:text-accent font-base text-xl transition-colors",children:o.toLowerCase()}),t.jsx("div",{className:"text-primary font-medium",children:(()=>{const e=n.replace(/\s+/g," ").trim();if(e.startsWith("FROM "))return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-1 text-sm text-gray-500",children:"FROM"}),t.jsx("span",{children:e.substring(5)})]});if(e.includes(" ")){const i=e.split(" ");return i.length===2&&i[0]&&i[1]?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-2 text-gray-500 line-through",children:i[0]}),t.jsx("span",{className:"text-red-400",children:i[1]})]}):t.jsx("span",{children:e})}else return t.jsx("span",{children:e})})()})]})})]})}function I(){return t.jsx("div",{className:"flex justify-center py-8",children:t.jsx("div",{className:"border-primary-600 h-8 w-8 animate-spin rounded-full border-b-2"})})}function q(){const{products:o,loading:n,hasMore:s,loadNextPage:g,currentPage:m}=k(),l=a.useRef(null),r=a.useRef(null);return a.useEffect(()=>{if(!(!s||!r.current))return l.current&&l.current.disconnect(),l.current=new IntersectionObserver(e=>{e[0].isIntersecting&&!n&&s&&g()},{threshold:.1,rootMargin:"200px"}),l.current.observe(r.current),()=>{l.current&&l.current.disconnect()}},[s,n,g]),t.jsxs("div",{children:[o.length>0&&t.jsx("div",{className:"mt-8 grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-8",children:o.map((e,i)=>{var c,h;return t.jsx(A,{title:e.title,price:e.price,imageUrl:(c=e.featured_image)==null?void 0:c.src,imageAlt:(h=e.featured_image)==null?void 0:h.alt,url:e.url,isServerRendered:i<12},e.id)})}),n&&t.jsx(I,{}),!s&&o.length>0&&t.jsx("div",{className:"text-primary py-8 text-center",children:"No more products."}),t.jsxs("div",{className:"text-primary mt-4 text-center text-sm",children:["Page ",m," ",s&&!n&&t.jsx("span",{className:"text-xs text-gray-400",children:"(Scroll for more)"})]}),t.jsx("div",{ref:r,className:"mt-4 h-10"})]})}class C extends HTMLElement{constructor(){super(...arguments);f(this,"root",null);f(this,"filterTrigger",null);f(this,"filterClose",null);f(this,"filterModal",null);f(this,"filterOverlay",null);f(this,"desktopFacetsContainer",null);f(this,"mobileFacetsContent",null);f(this,"filtersMoved",!1);f(this,"openModalHandler",()=>this.openModal());f(this,"closeModalHandler",()=>this.closeModal());f(this,"activeFiltersObserver",null)}connectedCallback(){if(this.root)return;const s=document.createElement("div");s.style.display="contents",this.appendChild(s);const g=parseInt(this.getAttribute("data-products-per-page")||"12",10),m=[],l=document.getElementById("product-grid");l&&l.querySelectorAll(".product-card").forEach(e=>{var b,x;const i=e.querySelector("h3"),c=e.querySelector(".product-prices"),h=e.querySelector("img"),v=e.querySelector("a[href]");i&&c&&v&&m.push({id:e.getAttribute("data-product-id")||"",title:((b=i.textContent)==null?void 0:b.trim())||"",price:((x=c.textContent)==null?void 0:x.trim())||"",url:v.getAttribute("href")||"",price_varies:e.getAttribute("data-price-varies")==="true",featured_image:{src:(h==null?void 0:h.getAttribute("src"))||"",alt:(h==null?void 0:h.getAttribute("alt"))||""}})}),typeof F.createRoot=="function"?(this.root=F.createRoot(s),this.root.render(t.jsx(P,{productsPerPage:g,initialProducts:m,children:t.jsx(q,{})}))):console.error("createRoot is not available. React environment might not be set up correctly."),requestAnimationFrame(()=>{var e,i;this.filterTrigger=document.getElementById("mobile-filter-trigger"),this.filterClose=document.getElementById("mobile-filter-close"),this.filterModal=document.getElementById("mobile-filter-modal"),this.filterOverlay=document.getElementById("mobile-filter-overlay"),this.desktopFacetsContainer=document.getElementById("desktop-facets-container"),this.mobileFacetsContent=document.getElementById("mobile-facets-content");const r=((e=this.mobileFacetsContent)==null?void 0:e.querySelector(".active-filters"))||((i=this.desktopFacetsContainer)==null?void 0:i.querySelector(".active-filters"));this.filterTrigger?this.filterTrigger.addEventListener("click",this.openModalHandler):console.warn("Mobile filter trigger button not found."),this.filterClose&&this.filterClose.addEventListener("click",this.closeModalHandler),this.filterOverlay&&this.filterOverlay.addEventListener("click",this.closeModalHandler),r?(this.setupActiveFiltersObserver(r),this.updateFilterButtonState(r)):console.warn("Active filters container not found for observer setup.")})}disconnectedCallback(){for(this.root&&(this.root.unmount(),this.root=null);this.firstChild;)this.removeChild(this.firstChild);this.activeFiltersObserver&&(this.activeFiltersObserver.disconnect(),this.activeFiltersObserver=null),this.filterTrigger&&this.filterTrigger.removeEventListener("click",this.openModalHandler),this.filterClose&&this.filterClose.removeEventListener("click",this.closeModalHandler),this.filterOverlay&&this.filterOverlay.removeEventListener("click",this.closeModalHandler),this.filtersMoved=!1}setupActiveFiltersObserver(s){this.activeFiltersObserver=new MutationObserver(()=>{this.updateFilterButtonState(s)}),this.activeFiltersObserver.observe(s,{childList:!0,subtree:!0})}updateFilterButtonState(s){if(!this.filterTrigger)return;const g=!!s.querySelector('a[href*="collections"]'),m=s.querySelectorAll('a[href*="collections"]').length,l=this.filterTrigger.querySelector(".filter-count"),r=this.filterTrigger.querySelector("svg");if(g)if(this.filterTrigger.classList.add("bg-secondary","text-white","hover:bg-secondary/90","border-secondary"),this.filterTrigger.classList.remove("bg-white","text-primary","hover:bg-gray-50","border-gray-300"),r==null||r.classList.remove("text-gray-400"),r==null||r.classList.add("text-white"),l)l.textContent=`(${m})`,l.classList.remove("hidden");else{const e=Array.from(this.filterTrigger.childNodes).find(c=>{var h;return c.nodeType===Node.TEXT_NODE&&((h=c.textContent)==null?void 0:h.includes("Filter"))});e&&(e.textContent="Filter");const i=document.createElement("span");i.className="filter-count ml-1",i.textContent=`(${m})`,this.filterTrigger.appendChild(i)}else{this.filterTrigger.classList.remove("bg-primary","text-white","hover:bg-primary/90","border-primary"),this.filterTrigger.classList.add("bg-white","text-primary","hover:bg-gray-50","border-gray-300"),r==null||r.classList.remove("text-white"),r==null||r.classList.add("text-gray-400"),l&&(l.classList.add("hidden"),l.textContent="(0)");const e=Array.from(this.filterTrigger.childNodes).find(i=>{var c;return i.nodeType===Node.TEXT_NODE&&((c=i.textContent)==null?void 0:c.includes("Filter"))});e&&(e.textContent="Filter")}}moveFiltersIfNeeded(){if(!this.filtersMoved&&window.innerWidth<1024&&this.desktopFacetsContainer&&this.mobileFacetsContent){for(;this.desktopFacetsContainer.firstChild;)this.mobileFacetsContent.appendChild(this.desktopFacetsContainer.firstChild);this.filtersMoved=!0}}openModal(){!this.filterModal||!this.filterOverlay||(this.moveFiltersIfNeeded(),this.filterModal.classList.remove("-translate-x-full"),this.filterModal.classList.add("translate-x-0"),this.filterOverlay.classList.remove("hidden"),document.body.style.overflow="hidden")}closeModal(){!this.filterModal||!this.filterOverlay||(this.filterModal.classList.remove("translate-x-0"),this.filterModal.classList.add("-translate-x-full"),this.filterOverlay.classList.add("hidden"),document.body.style.overflow="")}}f(C,"elementName","collection-infinite-scroll");customElements.get(C.elementName)?console.warn(`Custom element ${C.elementName} already defined.`):customElements.define(C.elementName,C);
